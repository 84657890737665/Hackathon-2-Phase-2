# Data Model: Authentication & User Management System

## Overview
This document defines the data models for the authentication system in the Todo Full-Stack Web Application. It outlines the structure of user data, authentication tokens, and relationships between entities.

## User Entity

### Fields
- **id** (Integer, Primary Key, Auto-increment)
  - Unique identifier for each user
  - Auto-generated by the database
- **email** (String, VARCHAR(255), Unique, Not Null)
  - User's email address used for authentication
  - Must be unique across all users
  - Used as the primary identifier for login
- **hashed_password** (String, VARCHAR(255), Not Null)
  - Securely hashed version of the user's password
  - Stored using bcrypt or argon2 algorithm
  - Never store plain text passwords
- **created_at** (DateTime, Not Null)
  - Timestamp when the user account was created
  - Automatically set to current time on creation
- **updated_at** (DateTime, Not Null)
  - Timestamp when the user account was last updated
  - Automatically updated when user data changes

### Relationships
- One User to Many Tasks (via user_id foreign key in tasks table)
- One User to Many Sessions (if implementing session tracking in the future)

### Validation Rules
- Email must be a valid email format (RFC 5322)
- Email must be unique across all users
- Email length must be between 5 and 255 characters
- Password must meet minimum security requirements (handled by Better Auth)
- Created_at and updated_at must be valid timestamps

## JWT Token Structure

### Claims
- **sub** (Subject)
  - Contains the user's unique identifier (user.id)
  - Used to identify the user associated with the token
- **email** (Email)
  - Contains the user's email address
  - Included for convenience without requiring database lookup
- **exp** (Expiration Time)
  - Unix timestamp indicating when the token expires
  - Set to 7 days from issuance time
- **iat** (Issued At)
  - Unix timestamp indicating when the token was issued
  - Used for tracking token age
- **user_id** (User ID)
  - Duplicate of sub for easier parsing in some contexts
  - Ensures consistency with API endpoint user_id parameter

### Token Properties
- Algorithm: RS256 (RSA Signature with SHA-256)
- Expiration: 7 days (604800 seconds) from issuance
- Issuer: The application name/version
- Audience: The intended recipient (the API)

## Database Schema

### Users Table
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_users_email ON users(email);
```

### Indexes
- **idx_users_email**: Index on email column for fast lookup during authentication
- Purpose: Optimize login queries and uniqueness constraint checks

## State Transitions

### User Account States
- **Pending**: Account created but not yet verified (if email verification is implemented later)
- **Active**: Account verified and ready for use
- **Disabled**: Account temporarily or permanently disabled by admin
- **Deleted**: Account marked for deletion (soft delete approach)

### Transition Rules
- Pending → Active: After email verification
- Active → Disabled: Admin action or violation of terms
- Disabled → Active: Admin action to re-enable
- Any state → Deleted: User or admin initiated deletion

## Security Considerations

### Data Protection
- Passwords must never be stored in plain text
- Use industry-standard hashing algorithms (bcrypt/argon2)
- Encrypt sensitive data in transit using HTTPS
- Implement proper access controls to prevent unauthorized access

### Privacy
- Only store necessary user information
- Implement data retention policies
- Allow users to request data export/deletion
- Log access to user data for audit purposes

## Future Extensions

### Possible Additions
- **profile_picture_url**: URL to user's profile picture
- **first_name**, **last_name**: User's personal information
- **phone_number**: For two-factor authentication
- **email_verified**: Boolean flag for email verification status
- **last_login**: Timestamp of last successful login
- **failed_login_attempts**: Counter for security purposes
- **locked_until**: Timestamp until which account is locked