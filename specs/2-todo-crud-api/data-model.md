# Data Model: Todo CRUD API & Data Persistence

## Overview
This document defines the data models for the Todo CRUD API & Data Persistence module in the Todo Full-Stack Web Application. It outlines the structure of task data, relationships between entities, and validation rules.

## Task Entity

### Fields
- **id** (Integer, Primary Key, Auto-increment)
  - Unique identifier for each task
  - Auto-generated by the database
- **user_id** (Integer, Foreign Key, Not Null)
  - References the user who owns this task
  - Links to the users table (from Plan 1)
  - Enforces foreign key constraint with cascade delete
- **title** (String, VARCHAR(255), Not Null)
  - The main title of the task
  - Required field for all tasks
  - Maximum length of 255 characters
- **description** (String, TEXT, Nullable)
  - Optional detailed description of the task
  - Can be null if no description is provided
  - No maximum length restriction
- **completed** (Boolean, Not Null, Default: False)
  - Indicates whether the task is completed
  - Defaults to False when creating new tasks
- **created_at** (DateTime, Not Null)
  - Timestamp when the task was created
  - Automatically set to current time on creation
- **updated_at** (DateTime, Not Null)
  - Timestamp when the task was last updated
  - Automatically updated when task data changes

### Relationships
- One User to Many Tasks (via user_id foreign key in tasks table)
- The relationship enforces that each task belongs to exactly one user

### Validation Rules
- Title must be between 1 and 255 characters
- Title cannot be empty or null
- User_id must reference an existing user in the users table
- Completed field must be a boolean value (true/false)
- created_at and updated_at must be valid timestamps

## Database Schema

### Tasks Table
```sql
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_user_id_created_at ON tasks(user_id, created_at DESC);
```

### Indexes
- **idx_tasks_user_id**: Index on user_id column for fast filtering by user
  - Purpose: Optimize queries that filter tasks by user_id
- **idx_tasks_user_id_created_at**: Composite index on user_id and created_at for sorting
  - Purpose: Optimize queries that filter by user and sort by creation date

## State Transitions

### Task Completion States
- **Incomplete**: completed = false (default state when created)
- **Complete**: completed = true (when user marks task as done)

### Transition Rules
- Incomplete → Complete: Via PATCH /api/{user_id}/tasks/{id}/complete endpoint
- Complete → Incomplete: Via same PATCH endpoint (toggle functionality)

## Business Logic

### Ownership Rules
- Each task is owned by exactly one user
- Users can only view, modify, or delete their own tasks
- When a user is deleted, all their tasks are automatically deleted (cascade delete)

### Creation Rules
- Tasks must have a valid title (1-255 characters)
- Tasks are created with completed = false by default
- User_id must reference an existing user account
- created_at and updated_at are automatically set by the database

### Modification Rules
- Title and description can be updated via PUT endpoint
- Completion status can be toggled via PATCH endpoint
- updated_at is automatically updated on any modification
- Users can only modify tasks they own

## API Response Models

### Task Response Schema
```json
{
  "id": 123,
  "user_id": 456,
  "title": "Task title",
  "description": "Optional task description",
  "completed": false,
  "created_at": "2023-01-01T10:00:00Z",
  "updated_at": "2023-01-01T10:00:00Z"
}
```

### Task List Response Schema
```json
{
  "tasks": [
    {
      "id": 123,
      "user_id": 456,
      "title": "Task title",
      "description": "Optional task description",
      "completed": false,
      "created_at": "2023-01-01T10:00:00Z",
      "updated_at": "2023-01-01T10:00:00Z"
    }
  ]
}
```

## Security Considerations

### Data Isolation
- Foreign key constraint ensures tasks are linked to valid users
- All queries must filter by user_id to prevent unauthorized access
- Cascade delete ensures data cleanup when users are removed

### Validation
- Input validation through Pydantic models prevents invalid data
- Length restrictions on title field prevent abuse
- Boolean field validation ensures completed field has valid values

## Future Extensions

### Possible Additions
- **priority_level**: Integer field for task priority (1-5 scale)
- **due_date**: DateTime field for task deadlines
- **category_id**: Foreign key to categories table for task grouping
- **tags**: Array of text tags for flexible task organization
- **parent_task_id**: Self-referencing foreign key for subtasks
- **estimated_duration**: Integer field for time estimation in minutes